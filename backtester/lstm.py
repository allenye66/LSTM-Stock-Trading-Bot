
import pandas as pd
import numpy as np
import keras
import tensorflow as tf
import sklearn.metrics as metrics
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.datasets import make_classification
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix
from sklearn.utils.multiclass import unique_labels
import seaborn as sns
import pickle
from sklearn.metrics import precision_score, recall_score, accuracy_score, balanced_accuracy_score, f1_score
import os
from collections import Counter
from keras.models import model_from_json
import pickle
from sklearn import preprocessing


json_file = open(
    './current_models/model2/lstm.json', 'r')
loaded_model_json = json_file.read()
json_file.close()

loaded_model = tf.keras.models.model_from_json(loaded_model_json)
loaded_model.load_weights('./current_models/model2/lstm.h5')

sc = pickle.load(
    open('./current_models/model2/scaler.pkl', 'rb'))


def predict_multiple_days(data, feature_length):

    def split(to_split):
        to_split = np.array_split(np.array(to_split), len(to_split)//390)
        return to_split

    days_data = split(data)

    preds = []
    for day_data in days_data:
        p = predict_day(day_data, feature_length)
        preds.append(p)

    return preds


def predict_day(data, feature_length):
    
    data = data[:feature_length]

    data = pd.DataFrame([data])

    normalized = preprocessing.normalize(data)
    data = pd.DataFrame(normalized)
    scaled = sc.fit_transform(data.T)
    data = pd.DataFrame(scaled.T)
    data = tf.reshape(
        data, data.shape + (1,))

    pred = loaded_model.predict(data)

    return pred[0][0]
'''

if __name__ == '__main__':
    test = [1356.6, 1359.3, 1358.85, 1358.35, 1358.29, 1358.18, 1358.27, 1358.32, 1358.32, 1358.39, 1357.64, 1358.09, 1357.4, 1357.83, 1358.19, 1358.24, 1357.79, 1357.78, 1357.2, 1357.4, 1357.67, 1357.86, 1357.12, 1356.99, 1356.7, 1356.19, 1356.69, 1356.68, 1356.87, 1356.92, 1356.64, 1356.63, 1356.87, 1357.33, 1357.44, 1357.39, 1357.57, 1357.6, 1358.16, 1357.88, 1357.62, 1357.75, 1358.0, 1357.72, 1357.84, 1358.0, 1357.92, 1357.94, 1358.97, 1360.27, 1360.17, 1359.22, 1359.1, 1358.21, 1357.4, 1357.48, 1356.66, 1356.38, 1355.4, 1355.88, 1355.67, 1356.22, 1356.2, 1356.48, 1356.5, 1356.9, 1356.5, 1356.38, 1356.6, 1356.6, 1356.16, 1356.25, 1356.47, 1356.0, 1355.66, 1354.71, 1354.5, 1353.79, 1354.11, 1354.36, 1353.94, 1354.38, 1354.42, 1354.33, 1354.41, 1354.03, 1353.5, 1352.72, 1354.27, 1355.37, 1354.76, 1354.48, 1355.05, 1354.1, 1353.33, 1353.12, 1353.08, 1353.7, 1353.04, 1353.11, 1352.97, 1353.1, 1353.06, 1353.72, 1353.53, 1353.77, 1354.1, 1355.59, 1356.98, 1356.46, 1356.64, 1356.34, 1356.46, 1356.54, 1356.53, 1356.41, 1356.33, 1356.33, 1356.06, 1355.85, 1356.01, 1355.91, 1355.53, 1355.7, 1355.49, 1355.81, 1356.36, 1356.4, 1356.24, 1356.25, 1356.24, 1356.22, 1356.03, 1356.87, 1356.38, 1356.5, 1356.44, 1356.35, 1356.05, 1356.47, 1356.45, 1356.27, 1355.63, 1355.52, 1356.04, 1355.52, 1355.89, 1355.99, 1355.48, 1355.65, 1355.38, 1355.78, 1355.72, 1355.3, 1355.28, 1355.01, 1354.86, 1354.88, 1355.07, 1355.25, 1355.1, 1354.73, 1355.33, 1355.32, 1355.27, 1355.22, 1355.03, 1355.17, 1355.25, 1354.93, 1355.01, 1354.8, 1354.63, 1354.83, 1354.79, 1354.79, 1354.79, 1354.63, 1354.59, 1354.21, 1353.74, 1353.62, 1353.77, 1353.79, 1353.65, 1353.63, 1353.21, 1353.29, 1353.22, 1353.23, 1353.59, 1353.59, 1353.51, 1353.44, 1353.59,
            1353.05, 1353.2, 1353.06, 1353.01, 1352.9, 1353.21, 1353.07, 1352.82, 1352.78, 1352.64, 1352.3, 1352.4, 1352.43, 1352.45, 1352.61, 1352.75, 1352.88, 1353.0, 1353.36, 1353.51, 1353.9, 1353.4, 1353.1, 1352.98, 1353.65, 1353.6, 1353.48, 1353.36, 1353.1, 1352.78, 1352.32, 1351.99, 1351.85, 1352.19, 1352.16, 1351.98, 1352.12, 1351.85, 1351.85, 1351.24, 1351.52, 1351.26, 1351.54, 1351.7, 1351.69, 1351.66, 1352.3, 1352.33, 1352.55, 1352.43, 1352.27, 1352.29, 1352.29, 1352.28, 1351.62, 1351.34, 1351.7, 1351.73, 1351.72, 1351.65, 1351.77, 1351.6, 1351.86, 1352.46, 1352.23, 1351.87, 1351.68, 1351.8, 1352.2, 1351.88, 1352.15, 1352.53, 1352.24, 1352.24, 1352.63, 1352.44, 1352.71, 1352.65, 1352.16, 1351.85, 1351.91, 1352.05, 1352.69, 1353.12, 1353.21, 1353.46, 1353.13, 1353.21, 1353.2, 1353.13, 1353.14, 1353.28, 1352.9, 1353.4, 1353.38, 1353.2, 1353.53, 1353.77, 1353.74, 1353.37, 1353.05, 1353.11, 1353.18, 1353.14, 1353.41, 1353.4, 1353.17, 1353.35, 1353.96, 1353.93, 1354.13, 1353.99, 1354.25, 1354.02, 1354.05, 1354.27, 1354.21, 1354.13, 1354.27, 1354.21, 1354.15, 1353.95, 1353.96, 1353.91, 1354.2, 1354.13, 1354.2, 1354.07, 1354.18, 1354.29, 1354.22, 1354.14, 1354.26, 1354.06, 1354.12, 1353.84, 1353.77, 1353.11, 1353.02, 1352.4, 1352.3, 1352.1, 1352.36, 1352.48, 1352.63, 1352.29, 1352.69, 1352.49, 1352.55, 1352.39, 1352.22, 1352.32, 1352.6, 1352.51, 1352.49, 1351.97, 1352.66, 1352.53, 1352.87, 1353.06, 1352.58, 1352.47, 1352.54, 1352.46, 1352.54, 1352.69, 1352.32, 1351.91, 1351.92, 1352.09, 1351.91, 1352.03, 1351.96, 1352.32, 1352.84, 1353.05, 1353.85, 1354.34, 1354.41, 1353.88, 1354.05, 1353.65, 1353.41, 1353.69, 1353.63, 1354.05, 1354.82, 1355.23, 1355.7, 1355.51, 1353.73, 1353.97, 1354.95, 1354.89, 1354.73]

    test2 = [1037.51, 1036.18, 1032.49, 1035.05, 1037.48, 1038.4, 1036.52, 1037.44, 1036.84, 1034.63, 1034.84, 1035.29, 1034.34, 1033.83, 1031.6, 1032.2, 1034.16, 1032.05, 1030.06, 1030.6, 1031.35, 1030.72, 1031.0, 1030.72, 1026.81, 1028.0, 1027.07, 1028.33, 1028.6, 1029.8, 1029.23, 1030.0, 1030.52, 1029.91, 1030.25, 1031.06, 1030.43, 1031.2, 1031.0, 1029.79, 1031.62, 1033.41, 1033.59, 1036.38, 1037.33, 1038.85, 1038.98, 1038.09, 1038.04, 1038.24, 1038.02, 1038.8, 1038.17, 1038.38, 1038.41, 1037.77, 1039.99, 1041.32, 1043.01, 1041.82, 1041.75, 1041.81, 1040.32, 1039.92, 1040.5, 1038.36, 1037.0, 1036.34, 1036.05, 1036.73, 1036.31, 1038.66, 1039.59, 1041.01, 1040.99, 1042.12, 1041.14, 1041.74, 1041.66, 1040.96, 1039.87, 1040.12, 1041.07, 1039.14, 1039.09, 1039.99, 1039.54, 1041.7, 1040.55, 1040.22, 1041.05, 1039.42, 1039.66, 1041.36, 1043.1, 1043.82, 1042.64, 1042.78, 1042.51, 1043.29, 1045.2, 1044.73, 1045.0, 1045.06, 1045.49, 1046.13, 1045.76, 1046.47, 1046.62, 1045.34, 1044.81, 1043.82, 1043.88, 1044.76, 1045.0, 1045.5, 1045.18, 1046.27, 1046.67, 1046.45, 1045.29, 1044.29, 1044.81, 1044.72, 1045.06, 1044.83, 1043.68, 1043.56, 1043.99, 1043.58, 1043.9, 1042.61, 1042.67, 1043.0, 1043.0, 1042.71, 1043.1, 1042.73, 1043.37, 1044.0, 1045.63, 1045.59, 1045.6, 1046.85, 1045.66, 1046.9, 1048.54, 1048.32, 1048.5, 1049.88, 1050.72, 1052.32, 1052.26, 1051.83, 1051.02, 1050.75, 1051.81, 1051.5, 1051.26, 1050.01, 1049.98, 1050.18, 1051.22, 1050.56, 1050.14, 1049.7, 1048.57, 1048.88, 1050.01, 1049.98, 1049.79, 1050.69, 1050.5, 1048.54, 1048.01, 1047.21, 1047.5, 1046.46, 1046.94, 1046.96, 1047.34, 1045.81, 1043.64, 1043.72, 1043.36, 1044.14, 1043.94, 1042.91, 1042.86, 1043.75, 1043.67, 1044.82, 1044.78, 1042.05, 1041.89,
             1042.88, 1044.19, 1044.38, 1044.0, 1043.72, 1043.72, 1043.72, 1043.28, 1042.64, 1042.34, 1042.37, 1040.2, 1039.92, 1039.77, 1038.48, 1037.82, 1037.53, 1036.86, 1037.79, 1037.08, 1036.57, 1037.99, 1038.4, 1038.85, 1041.48, 1040.57, 1041.2, 1039.88, 1039.73, 1039.24, 1038.89, 1038.79, 1037.89, 1037.25, 1037.96, 1035.89, 1034.45, 1033.63, 1032.95, 1033.17, 1032.98, 1032.86, 1032.69, 1032.08, 1030.76, 1031.18, 1032.91, 1031.81, 1030.58, 1029.25, 1026.29, 1025.95, 1024.57, 1022.25, 1022.0, 1022.89, 1023.24, 1024.74, 1024.53, 1025.33, 1024.31, 1024.46, 1023.06, 1022.46, 1023.03, 1023.64, 1021.25, 1023.4, 1023.78, 1025.08, 1025.59, 1026.0, 1026.38, 1026.14, 1026.0, 1024.0, 1024.53, 1025.0, 1023.59, 1022.25, 1021.43, 1021.36, 1021.42, 1021.37, 1020.6, 1020.17, 1020.6, 1021.78, 1020.6, 1020.35, 1021.02, 1020.04, 1021.24, 1020.95, 1020.89, 1021.71, 1023.0, 1024.21, 1024.0, 1023.08, 1022.56, 1021.74, 1022.93, 1021.85, 1020.81, 1020.0, 1020.3, 1019.9, 1020.44, 1020.71, 1020.62, 1019.21, 1020.0, 1020.0, 1020.0, 1019.76, 1022.44, 1023.81, 1022.94, 1022.73, 1022.87, 1023.66, 1023.68, 1025.0, 1024.03, 1024.44, 1022.88, 1022.12, 1022.5, 1021.22, 1021.52, 1020.99, 1020.67, 1020.79, 1020.87, 1021.24, 1020.74, 1020.45, 1020.36, 1020.33, 1020.06, 1019.98, 1021.79, 1020.08, 1020.09, 1019.33, 1019.47, 1019.98, 1019.13, 1019.07, 1020.08, 1018.42, 1018.69, 1018.32, 1019.41, 1018.74, 1018.12, 1018.27, 1016.79, 1014.57, 1015.39, 1013.79, 1013.19, 1012.28, 1011.88, 1010.76, 1010.3, 1009.89, 1010.25, 1010.08, 1009.5, 1009.03, 1010.18, 1011.42, 1011.3, 1011.03, 1009.58, 1010.3, 1009.71, 1010.7, 1010.09, 1012.86, 1011.05, 1009.34, 1008.59, 1010.28, 1010.53, 1011.67, 1011.23, 1012.14, 1011.95, 1013.57, 1014.53, 1015.39, 1016.53]

    test3 = test + test2

    test4 = [1037.51, 1036.18, 1032.49, 1035.05, 1037.48, 1038.4, 1036.52, 1037.44, 1036.84, 1034.63, 1034.84, 1035.29, 1034.34, 1033.83, 1031.6, 1032.2, 1034.16, 1032.05, 1030.06, 1030.6, 1031.35, 1030.72, 1031.0, 1030.72, 1026.81, 1028.0, 1027.07, 1028.33, 1028.6, 1029.8, 1029.23, 1030.0, 1030.52, 1029.91, 1030.25, 1031.06, 1030.43, 1031.2, 1031.0, 1029.79, 1031.62, 1033.41, 1033.59, 1036.38, 1037.33, 1038.85, 1038.98, 1038.09, 1038.04, 1038.24, 1038.02, 1038.8, 1038.17, 1038.38, 1038.41, 1037.77, 1039.99, 1041.32, 1043.01, 1041.82, 1041.75, 1041.81, 1040.32, 1039.92, 1040.5, 1038.36, 1037.0, 1036.34, 1036.05, 1036.73, 1036.31, 1038.66, 1039.59, 1041.01, 1040.99, 1042.12, 1041.14, 1041.74, 1041.66, 1040.96, 1039.87, 1040.12, 1041.07, 1039.14, 1039.09, 1039.99, 1039.54, 1041.7, 1040.55, 1040.22, 1041.05, 1039.42, 1039.66, 1041.36, 1043.1, 1043.82, 1042.64, 1042.78, 1042.51, 1043.29, 1045.2, 1044.73, 1045.0, 1045.06, 1045.49, 1046.13, 1045.76, 1046.47, 1046.62, 1045.34, 1044.81, 1043.82, 1043.88, 1044.76, 1045.0, 1045.5, 1045.18, 1046.27, 1046.67, 1046.45, 1045.29, 1044.29, 1044.81, 1044.72, 1045.06,
             1044.83, 1043.68, 1043.56, 1043.99, 1043.58, 1043.9, 1042.61, 1042.67, 1043.0, 1043.0, 1042.71, 1043.1, 1042.73, 1043.37, 1044.0, 1045.63, 1045.59, 1045.6, 1046.85, 1045.66, 1046.9, 1048.54, 1048.32, 1048.5, 1049.88, 1050.72, 1052.32, 1052.26, 1051.83, 1051.02, 1050.75, 1051.81, 1051.5, 1051.26, 1050.01, 1049.98, 1050.18, 1051.22, 1050.56, 1050.14, 1049.7, 1048.57, 1048.88, 1050.01, 1049.98, 1049.79, 1050.69, 1050.5, 1048.54, 1048.01, 1047.21, 1047.5, 1046.46, 1046.94, 1046.96, 1047.34, 1045.81, 1043.64, 1043.72, 1043.36, 1044.14, 1043.94, 1042.91, 1042.86, 1043.75, 1043.67, 1044.82, 1044.78, 1042.05, 1041.89, 1042.88, 1044.19, 1044.38, 1044.0, 1043.72, 1043.72, 1043.72, 1043.28, 1042.64, 1042.34, 1042.37, 1040.2, 1039.92, 1039.77, 1038.48, 1037.82, 1037.53, 1036.86, 1037.79, 1037.08, 1036.57, 1037.99, 1038.4, 1038.85, 1041.48, 1040.57, 1041.2, 1039.88, 1039.73, 1039.24, 1038.89, 1038.79, 1037.89, 1037.25, 1037.96, 1035.89, 1034.45, 1033.63, 1032.95, 1033.17, 1032.98, 1032.86, 1032.69, 1032.08, 1030.76, 1031.18, 1032.91, 1031.81, 1030.58, 1029.25, 1026.29, 1025.95, 1024.57, 1022.25, 1022.0]
    #print(predict_day(test4, 250))
    #print(predict_day(test, 250))
    #print(predict_day(test2, 250))
    #print((predict_multiple_days(test3, 250)))
'''